Building DAG of jobs...
candidate job all
	wildcards: 
candidate job peakcall
	wildcards: tiss=liver, anim=pig1, sample=pig1_liver
candidate job remove_pcrdup
	wildcards: tiss=liver, anim=pig1, sample=pig1_liver
candidate job remove_mito
	wildcards: tiss=liver, anim=pig1, sample=pig1_liver
candidate job bamq10sort
	wildcards: tiss=liver, anim=pig1, sample=pig1_liver
candidate job mapq10paired
	wildcards: tiss=liver, anim=pig1, sample=pig1_liver
candidate job mapq10
	wildcards: tiss=liver, anim=pig1, sample=pig1_liver
candidate job bamsort
	wildcards: tiss=liver, anim=pig1, sample=pig1_liver
candidate job samtobam
	wildcards: tiss=liver, anim=pig1, sample=pig1_liver
candidate job map
	wildcards: tiss=liver, anim=pig1, sample=pig1_liver
candidate job trimming
	wildcards: tiss=liver, anim=pig1, sample=pig1_liver
selected job trimming
	wildcards: tiss=liver, anim=pig1, sample=pig1_liver
candidate job trimming
	wildcards: tiss=liver, anim=pig1, sample=pig1_liver
selected job trimming
	wildcards: tiss=liver, anim=pig1, sample=pig1_liver
selected job map
	wildcards: tiss=liver, anim=pig1, sample=pig1_liver
selected job samtobam
	wildcards: tiss=liver, anim=pig1, sample=pig1_liver
selected job bamsort
	wildcards: tiss=liver, anim=pig1, sample=pig1_liver
selected job mapq10
	wildcards: tiss=liver, anim=pig1, sample=pig1_liver
selected job mapq10paired
	wildcards: tiss=liver, anim=pig1, sample=pig1_liver
selected job bamq10sort
	wildcards: tiss=liver, anim=pig1, sample=pig1_liver
candidate job bamq10index
	wildcards: tiss=liver, anim=pig1, sample=pig1_liver
candidate job bamq10sort
	wildcards: tiss=liver, anim=pig1, sample=pig1_liver
selected job bamq10sort
	wildcards: tiss=liver, anim=pig1, sample=pig1_liver
selected job bamq10index
	wildcards: tiss=liver, anim=pig1, sample=pig1_liver
selected job remove_mito
	wildcards: tiss=liver, anim=pig1, sample=pig1_liver
selected job remove_pcrdup
	wildcards: tiss=liver, anim=pig1, sample=pig1_liver
selected job peakcall
	wildcards: tiss=liver, anim=pig1, sample=pig1_liver
selected job all
	wildcards: 
Using shell: /usr/bin/bash
Provided cluster nodes: 30
Job counts:
	count	jobs
	1	all
	1	bamq10index
	1	bamq10sort
	1	bamsort
	1	map
	1	mapq10
	1	mapq10paired
	1	peakcall
	1	remove_mito
	1	remove_pcrdup
	1	samtobam
	11

[Thu Aug 22 13:30:57 2019]
rule map:
    input: liver/pig1/trimming/pig1_liver/pig1_liver_R1_val_1.fq.gz, liver/pig1/trimming/pig1_liver/pig1_liver_R2_val_2.fq.gz
    output: liver/pig1/mapping/pig1_liver.sam
    log: logs/mapping/liver/pig1/pig1_liver.map.log
    jobid: 10
    wildcards: tiss=liver, anim=pig1, sample=pig1_liver
    threads: 4

bowtie2 -t -p 4 -X 2000 -x /work/project/fragencode/tools/atacseq/fragencode-atacseq-pipeline/test/small.fa -1 liver/pig1/trimming/pig1_liver/pig1_liver_R1_val_1.fq.gz -2 liver/pig1/trimming/pig1_liver/pig1_liver_R2_val_2.fq.gz --met 60 --met-file logs/mapping/liver/pig1/pig1_liver.map.log -S liver/pig1/mapping/pig1_liver.sam
Submitted DRMAA job 10 with external jobid 7362993.
[Thu Aug 22 13:32:47 2019]
Finished job 10.
1 of 11 steps (9%) done

[Thu Aug 22 13:32:47 2019]
rule samtobam:
    input: liver/pig1/mapping/pig1_liver.sam
    output: liver/pig1/mapping/pig1_liver.unsorted.bam
    log: logs/mapping/liver/pig1/pig1_liver.tobam.log
    jobid: 9
    wildcards: tiss=liver, anim=pig1, sample=pig1_liver
    threads: 4

samtools view liver/pig1/mapping/pig1_liver.sam -Sbh -@ 4 -o liver/pig1/mapping/pig1_liver.unsorted.bam 2> logs/mapping/liver/pig1/pig1_liver.tobam.log
Submitted DRMAA job 9 with external jobid 7363005.
[Thu Aug 22 13:33:07 2019]
Finished job 9.
2 of 11 steps (18%) done

[Thu Aug 22 13:33:07 2019]
rule bamsort:
    input: liver/pig1/mapping/pig1_liver.unsorted.bam
    output: liver/pig1/mapping/pig1_liver.bam
    log: logs/mapping/liver/pig1/pig1_liver.bamsort.log
    jobid: 8
    wildcards: tiss=liver, anim=pig1, sample=pig1_liver
    threads: 4

samtools sort -@ 4 -m 4G liver/pig1/mapping/pig1_liver.unsorted.bam -O bam -o liver/pig1/mapping/pig1_liver.bam 2> logs/mapping/liver/pig1/pig1_liver.bamsort.log
Submitted DRMAA job 8 with external jobid 7363008.
Removing temporary output file liver/pig1/mapping/pig1_liver.unsorted.bam.
[Thu Aug 22 13:33:17 2019]
Finished job 8.
3 of 11 steps (27%) done

[Thu Aug 22 13:33:17 2019]
rule mapq10:
    input: liver/pig1/mapping/pig1_liver.bam
    output: liver/pig1/mapping/pig1_liver.mono.bam
    log: logs/mapping/liver/pig1/pig1_liver.mapq10.log
    jobid: 7
    wildcards: tiss=liver, anim=pig1, sample=pig1_liver
    threads: 4

samtools view -@ 4 -F 12 -q 10 -bh liver/pig1/mapping/pig1_liver.bam > liver/pig1/mapping/pig1_liver.mono.bam 2> logs/mapping/liver/pig1/pig1_liver.mapq10.log
Submitted DRMAA job 7 with external jobid 7363009.
[Thu Aug 22 13:33:27 2019]
Finished job 7.
4 of 11 steps (36%) done

[Thu Aug 22 13:33:27 2019]
rule mapq10paired:
    input: liver/pig1/mapping/pig1_liver.mono.bam
    output: liver/pig1/mapping/pig1_liver.paired.unsorted.bam
    log: logs/mapping/liver/pig1/pig1_liver.mapq10.paired.log
    jobid: 6
    wildcards: tiss=liver, anim=pig1, sample=pig1_liver
    threads: 4

samtools sort -n -@ 4 -m 4G liver/pig1/mapping/pig1_liver.mono.bam -o - | samtools view -h - | awk -f scripts/keep.paired.reads.awk | samtools view -Sbh - > liver/pig1/mapping/pig1_liver.paired.unsorted.bam 2> logs/mapping/liver/pig1/pig1_liver.mapq10.paired.log
Submitted DRMAA job 6 with external jobid 7363013.
Removing temporary output file liver/pig1/mapping/pig1_liver.mono.bam.
[Thu Aug 22 13:33:37 2019]
Finished job 6.
5 of 11 steps (45%) done

[Thu Aug 22 13:33:37 2019]
rule bamq10sort:
    input: liver/pig1/mapping/pig1_liver.paired.unsorted.bam
    output: liver/pig1/mapping/pig1_liver.q10.bam
    log: logs/mapping/liver/pig1/pig1_liver.bamq10.sort.log
    jobid: 4
    wildcards: tiss=liver, anim=pig1, sample=pig1_liver
    threads: 4

samtools sort -@ 4 -m 4G liver/pig1/mapping/pig1_liver.paired.unsorted.bam -O bam -o liver/pig1/mapping/pig1_liver.q10.bam 2> logs/mapping/liver/pig1/pig1_liver.bamq10.sort.log
Submitted DRMAA job 4 with external jobid 7363017.
Removing temporary output file liver/pig1/mapping/pig1_liver.paired.unsorted.bam.
[Thu Aug 22 13:33:47 2019]
Finished job 4.
6 of 11 steps (55%) done

[Thu Aug 22 13:33:47 2019]
rule bamq10index:
    input: liver/pig1/mapping/pig1_liver.q10.bam
    output: liver/pig1/mapping/pig1_liver.q10.bam.bai
    log: logs/mapping/liver/pig1/pig1_liver.bamq10.index.log
    jobid: 5
    wildcards: tiss=liver, anim=pig1, sample=pig1_liver

samtools index liver/pig1/mapping/pig1_liver.q10.bam 2> logs/mapping/liver/pig1/pig1_liver.bamq10.index.log
Submitted DRMAA job 5 with external jobid 7363020.
[Thu Aug 22 13:34:07 2019]
Finished job 5.
7 of 11 steps (64%) done

[Thu Aug 22 13:34:07 2019]
rule remove_mito:
    input: liver/pig1/mapping/pig1_liver.q10.bam, liver/pig1/mapping/pig1_liver.q10.bam.bai
    output: liver/pig1/filtering/pig1_liver.q10.noMT.bam
    log: logs/filtering/liver/pig1/pig1_liver.noMT.log
    jobid: 3
    wildcards: tiss=liver, anim=pig1, sample=pig1_liver

samtools idxstats liver/pig1/mapping/pig1_liver.q10.bam | awk '{print $1}' | grep -v MT | xargs samtools view -bh liver/pig1/mapping/pig1_liver.q10.bam liver/pig1/mapping/pig1_liver.q10.bam.bai > liver/pig1/filtering/pig1_liver.q10.noMT.bam 2> logs/filtering/liver/pig1/pig1_liver.noMT.log
Submitted DRMAA job 3 with external jobid 7363022.
[Thu Aug 22 13:34:17 2019]
Finished job 3.
8 of 11 steps (73%) done

[Thu Aug 22 13:34:17 2019]
rule remove_pcrdup:
    input: liver/pig1/filtering/pig1_liver.q10.noMT.bam
    output: liver/pig1/filtering/pig1_liver.q10.noMT.nodup.bam, liver/pig1/filtering/pig1_liver.q10.noMT.nodup.bam.metrics.txt
    log: logs/filtering/liver/pig1/pig1_liver.noMTremovePCRdup.log
    jobid: 2
    wildcards: tiss=liver, anim=pig1, sample=pig1_liver

java -jar -Xmx4g /work/project/fragencode/tools/multi/picard-tools-2.20.4/picard.jar MarkDuplicates I=liver/pig1/filtering/pig1_liver.q10.noMT.bam O=liver/pig1/filtering/pig1_liver.q10.noMT.nodup.bam M=liver/pig1/filtering/pig1_liver.q10.noMT.nodup.bam.metrics.txt REMOVE_DUPLICATES=true 2> logs/filtering/liver/pig1/pig1_liver.noMTremovePCRdup.log
Submitted DRMAA job 2 with external jobid 7363023.
[Thu Aug 22 13:34:47 2019]
Finished job 2.
9 of 11 steps (82%) done

[Thu Aug 22 13:34:47 2019]
rule peakcall:
    input: liver/pig1/filtering/pig1_liver.q10.noMT.nodup.bam
    output: liver/pig1/peaks/pig1_liver.q10.noMT.nodup.macs_peaks.narrowPeak
    log: logs/peakcalling/liver/pig1/pig1_liver.peakcall.log
    jobid: 1
    wildcards: tiss=liver, anim=pig1, sample=pig1_liver

macs2 callpeak --nomodel -f BAMPE -t liver/pig1/filtering/pig1_liver.q10.noMT.nodup.bam -n liver/pig1/peaks/pig1_liver.q10.noMT.nodup.macs --keep-dup all --verbose 0 2> logs/peakcalling/liver/pig1/pig1_liver.peakcall.log
Submitted DRMAA job 1 with external jobid 7363029.
[Thu Aug 22 13:35:07 2019]
Finished job 1.
10 of 11 steps (91%) done

[Thu Aug 22 13:35:07 2019]
localrule all:
    input: liver/pig1/peaks/pig1_liver.q10.noMT.nodup.macs_peaks.narrowPeak
    jobid: 0

[Thu Aug 22 13:35:07 2019]
Finished job 0.
11 of 11 steps (100%) done
Complete log: /work/project/fragencode/tools/atacseq/fragencode-atacseq-pipeline/test/.snakemake/log/2019-08-22T133051.919893.snakemake.log
